<record id="view_freight_operation_form_inherit" model="ir.ui.view">
    <field name="name">freight.operation.form.inherit</field>
    <field name="model">freight.operation</field>
    <field name="inherit_id" ref="custom_freight.view_freight_operation_form"/>
    <field name="arch" type="xml">
        <!-- Ajout des boutons dans la barre d'actions -->
        <xpath expr="//sheet/div[@name='button_box']" position="inside">
            <button name="action_open_project" 
                    type="object" 
                    class="oe_stat_button" 
                    icon="fa-tasks"
                    invisible = "project_id == False">
                <field name="pending_task_count" widget="statinfo" string="En attente"/>
            </button>
            <button name="action_generate_tasks" 
                    type="object" 
                    class="oe_highlight"
                    invisible = "project_id == False"
                    string="Générer Tâches"/>
        </xpath>

        <!-- Ajout de l'onglet Tâches -->
        <xpath expr="//sheet/notebook" position="inside">
            <page string="Tâches" invisible = "project_id == False">
                <field name="task_ids" mode="kanban,tree,form">
                    <kanban>
                        <field name="stage_id"/>
                        <templates>
                            <t t-name="kanban-box">
                                <div class="oe_kanban_global_click">
                                    <div class="o_kanban_record_title">
                                        <field name="name"/>
                                    </div>
                                    <div>
                                        <field name="user_id" widget="many2one_avatar"/>
                                    </div>
                                    <div>
                                        <field name="stage_id"/>
                                    </div>
                                </div>
                            </t>
                        </templates>
                    </kanban>
                    <tree>
                        <field name="name"/>
                        <field name="user_id"/>
                        <field name="stage_id"/>
                        <field name="date_deadline"/>
                    </tree>
                    <form>
                        <group>
                            <field name="name"/>
                            <field name="user_id"/>
                            <field name="stage_id"/>
                            <field name="date_deadline"/>
                            <field name="description" widget="html"/>
                        </group>
                    </form>
                </field>
            </page>
        </xpath>
    </field>
</record>